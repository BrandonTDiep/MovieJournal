@startuml
' compact class icons
skinparam classAttributeIconSize 0

' Design Patterns (5 total):
' 1. Builder Pattern - User.Builder, MovieReview.Builder
' 2. Observer Pattern - ReviewChangeListener, MovieReviewManager
' 3. Strategy Pattern - SortStrategy and implementations
' 4. Singleton Pattern - DatabaseConnection
' 5. Factory Pattern - PanelFactory

' ----- packages & stereotypes -----
package "com.cpp.moviejournal.model" {
  class User {
    - int id
    - String username
    - String email
    - String password            ' hashed, do not expose
    - LocalDateTime createdAt
    - LocalDateTime lastLogin
    - boolean isActive
    --
    + User()
    + User(String, String, String)
    + User(int, String, String, String, LocalDateTime, LocalDateTime, boolean)
    + boolean verifyPassword(String plainText)
    + void setPlainTextPassword(String plainText)
    + void setPassword(String hashed)
    + static Builder builder()
    ' (getters/setters intentionally omitted for clarity)
  }

  class "User.Builder" as UserBuilder <<Builder>> {
    - int id
    - String username
    - String email
    - String password
    - boolean passwordIsPlaintext
    - LocalDateTime createdAt
    - LocalDateTime lastLogin
    - boolean isActive
    --
    + Builder id(int)
    + Builder username(String)
    + Builder email(String)
    + Builder plainTextPassword(String)
    + Builder hashedPassword(String)
    + Builder createdAt(LocalDateTime)
    + Builder lastLogin(LocalDateTime)
    + Builder active(boolean)
    + User build()
  }

  class MovieReview {
    - int id
    - String title
    - String director
    - String genre
    - double rating
    - String review
    - LocalDate dateWatched
    - String ticketImagePath
    - boolean favorite
    --
    + MovieReview(int, String, String, String, double, String)
    + MovieReview(int, int, String, String, String, double, String, LocalDate)
    + MovieReview(int, int, String, String, String, double, String, LocalDate, String, boolean)
    + MovieReview(String, String, String, double, String)
    + String getTicketImagePath()
    + void setTicketImagePath(String)
    + boolean isFavorite()
    + void setFavorite(boolean)
    + static Builder builder()
  }

  class "MovieReview.Builder" as MovieReviewBuilder <<Builder>> {
    - int id
    - int userId
    - String title
    - String director
    - String genre
    - double rating
    - String review
    - LocalDate dateWatched
    - String ticketImagePath
    - boolean favorite
    --
    + Builder setId(int)
    + Builder setUserId(int)
    + Builder setTitle(String)
    + Builder setDirector(String)
    + Builder setGenre(String)
    + Builder setRating(double)
    + Builder setReview(String)
    + Builder setDateWatched(LocalDate)
    + Builder setTicketImagePath(String)
    + Builder setFavorite(boolean)
    + MovieReview build()
  }
}

package "com.cpp.moviejournal.manager" {
  interface ReviewChangeListener <<Observer>> {
    + onReviewAdded(MovieReview)
    + onReviewUpdated(MovieReview)
    + onReviewDeleted(int)
    + onReviewsBulkDeleted(int)
    + onReviewsCleared()
  }

  class MovieReviewManager <<Subject>> {
    - int currentUserId
    - List<ReviewChangeListener> listeners
    --
    + addReview(MovieReview)
    + updateReview(MovieReview, MovieReview)
    + deleteReview(MovieReview)
    + deleteReviews(List<MovieReview>) : int
    + clearAllReviews()
    + addReviewChangeListener(ReviewChangeListener)
    + removeReviewChangeListener(ReviewChangeListener)
    + getSortedReviews(String) : List<MovieReview>
    + getFavoriteReviews() : List<MovieReview>
    + setFavoriteStatus(MovieReview, boolean)
    + getReviewsWithTickets() : int
  }
}

package "com.cpp.moviejournal.strategy" {
  interface SortStrategy <<Strategy>> {
    + sort(List<MovieReview>) : List<MovieReview>
  }
  
  class DateNewestSortStrategy <<Strategy>> {
    + sort(List<MovieReview>) : List<MovieReview>
  }
  
  class DateOldestSortStrategy <<Strategy>> {
    + sort(List<MovieReview>) : List<MovieReview>
  }
  
  class RatingHighSortStrategy <<Strategy>> {
    + sort(List<MovieReview>) : List<MovieReview>
  }
  
  class RatingLowSortStrategy <<Strategy>> {
    + sort(List<MovieReview>) : List<MovieReview>
  }
  
  class TitleAscendingSortStrategy <<Strategy>> {
    + sort(List<MovieReview>) : List<MovieReview>
  }
  
  class TitleDescendingSortStrategy <<Strategy>> {
    + sort(List<MovieReview>) : List<MovieReview>
  }
  
  class SortStrategyFactory <<Factory>> {
    + {static} createStrategy(String) : SortStrategy
  }
}

package "com.cpp.moviejournal.util" {
  class DatabaseConnection <<Singleton>> {
    - {static} volatile DatabaseConnection instance
    - String url
    - String user
    - String password
    --
    - DatabaseConnection()
    + {static} getInstance() : DatabaseConnection
    + getConnectionInstance() : Connection
    + {static} getConnection() : Connection
  }
}

package "com.cpp.moviejournal.factory" {
  class PanelFactory <<Factory>> {
    + {static} createPanel(PanelType, MovieReviewManager, UserManager) : JPanel
    + {static} createLoginPanel() : JPanel
    + {static} createSignupPanel() : JPanel
    + {static} createDashboardPanel(MovieReviewManager) : JPanel
    + {static} createReviewManagementPanel(MovieReviewManager) : JPanel
    + {static} createFavoriteReviewsPanel(MovieReviewManager) : JPanel
    + {static} createUserProfilePanel(UserManager) : JPanel
  }
  
  enum PanelType {
    LOGIN
    SIGNUP
    DASHBOARD
    REVIEW_MANAGEMENT
    FAVORITE_REVIEWS
    USER_PROFILE
  }
}

package "com.cpp.moviejournal.gui" {
  class DashboardPanel {
    + refreshData()
    + setMovieReviewManager(MovieReviewManager)
  }
  
  class ReviewManagementPanel {
    + refreshData()
    + setMovieReviewManager(MovieReviewManager)
    + handleTicketUpload()
    + toggleFavoriteSelectedReview()
    + updateTicketPreview(String)
  }
  
  class FavoriteReviewsPanel {
    + refreshData()
    + setMovieReviewManager(MovieReviewManager)
    + displayTicketPreview(String)
  }
}

' ----- relationships -----
' Builder Pattern: dependency (creates) â€” lightweight, not ownership/composition
User ..> UserBuilder : creates
MovieReview ..> MovieReviewBuilder : creates

' Domain association: user (1) writes 0..* reviews
User "1" --> "0..*" MovieReview : writes >

' Observer Pattern: aggregation + interface implementation
MovieReviewManager "1" o-- "*" ReviewChangeListener : notifies
DashboardPanel ..|> ReviewChangeListener
ReviewManagementPanel ..|> ReviewChangeListener
FavoriteReviewsPanel ..|> ReviewChangeListener

' Strategy Pattern: MovieReviewManager uses SortStrategy
MovieReviewManager ..> SortStrategy : uses
SortStrategy <|.. DateNewestSortStrategy
SortStrategy <|.. DateOldestSortStrategy
SortStrategy <|.. RatingHighSortStrategy
SortStrategy <|.. RatingLowSortStrategy
SortStrategy <|.. TitleAscendingSortStrategy
SortStrategy <|.. TitleDescendingSortStrategy
SortStrategyFactory ..> SortStrategy : creates

' Singleton Pattern: DatabaseConnection
DatabaseConnection --> DatabaseConnection : getInstance()

' Factory Pattern: PanelFactory creates panels
PanelFactory ..> DashboardPanel : creates
PanelFactory ..> ReviewManagementPanel : creates
PanelFactory ..> FavoriteReviewsPanel : creates
PanelFactory ..> PanelType : uses

' Ticket Upload and Favorite Features
MovieReview --> ReviewManagementPanel : ticket upload
MovieReview --> FavoriteReviewsPanel : favorite display
MovieReviewManager --> MovieReview : manages favorites & tickets

@enduml
